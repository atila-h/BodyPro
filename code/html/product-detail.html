<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - BODYPOMP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/enhancements.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg fixed-top" id="mainNavbar">
      <div class="container-fluid">
        <a class="navbar-brand" href="../../index.html">
          <img src="../../logo/logo.gym.white.png" class="logo-white" alt="BODYPOMP Logo" height="40">
          <img src="../../logo/logo.gym.black.png" class="logo-black" alt="BODYPOMP Logo" height="40">
          <span class="brand-text">BODYPOMP</span>
        </a>
        
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav mx-auto">
            <li class="nav-item"><a class="nav-link" href="../../index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="../../index.html#products">Shop</a></li>
            <li class="nav-item"><a class="nav-link" href="../../index.html#categories">Categories</a></li>
            <li class="nav-item"><a class="nav-link" href="product-detail.html">Product Detail</a></li>
          </ul>
          
          <div class="nav-actions">
            <button class="nav-btn" id="cartBtn" aria-label="Shopping Cart">
              <i class="fas fa-shopping-cart"></i>
              <span class="badge" id="cartCount">0</span>
            </button>
            
            <button class="nav-btn" id="wishlistBtn" data-bs-toggle="modal" data-bs-target="#likesModal">
              <i class="fas fa-heart"></i>
              <span class="badge" id="likesCount">0</span>
            </button>
            
            <button class="theme-toggle" id="themeToggle">
              <i class="fas fa-moon"></i>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Product Detail Section -->
    <section class="product-detail-section">
        <div class="container">
            <div class="row g-5">
                <!-- Left Side - Product Image -->
                <div class="col-lg-6">
                    <div class="product-image-container">
                        <div class="discount-badge-large" id="productDiscount"></div>
                        <img id="productImage" src="" alt="Product Image" class="img-fluid">
                    </div>
                </div>
                
                <!-- Right Side - Product Details -->
                <div class="col-lg-6">
                    <div class="product-details">
                        <!-- Category & Rating -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="product-category" id="productCategory"></span>
                            <div class="product-rating-large" id="productRating"></div>
                        </div>
                        
                        <!-- Product Name -->
                        <h1 class="product-title" id="productName"></h1>
                        
                        <!-- Price -->
                        <div class="product-price-section mb-4">
                            <span class="current-price" id="productPrice"></span>
                            <span class="old-price" id="productOldPrice"></span>
                        </div>
                        
                        <!-- Stock Status -->
                        <div class="stock-status-large mb-4" id="productStock"></div>
                        
                        <!-- Description -->
                        <div class="product-description mb-4">
                            <h5>Description</h5>
                            <p id="productDescription"></p>
                        </div>
                        
                        <!-- Flavor/Taste Selection -->
                        <div class="flavor-section mb-4" id="flavorSection">
                            <h5>Available Flavors</h5>
                            <div class="flavor-options" id="flavorOptions"></div>
                        </div>
                        
                        <!-- Quantity Selector -->
                        <div class="quantity-section mb-4">
                            <h5>Quantity</h5>
                            <div class="quantity-selector">
                                <button class="qty-btn" onclick="updateDetailQuantity(-1)">-</button>
                                <input type="number" id="detailQuantity" value="1" min="1" max="10" readonly>
                                <button class="qty-btn" onclick="updateDetailQuantity(1)">+</button>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="product-actions-large">
                            <button class="btn btn-add-cart-large" id="addToCartBtn" onclick="addCurrentProductToCart()">
                                <i class="fas fa-cart-plus me-2"></i> Add to Cart
                            </button>
                            <button class="btn btn-like-large" id="likeBtn" onclick="toggleCurrentProductLike()">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                        
                        <!-- Back Button -->
                        <a href="javascript:history.back()" class="btn btn-outline-secondary mt-4">
                            <i class="fas fa-arrow-left me-2"></i> Back to Products
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Reviews Section -->
            <div class="row mt-5">
                <div class="col-12">
                    <div class="reviews-section">
                        <h3 class="mb-4">Customer Reviews</h3>
                        <div id="reviewsContainer"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h5 class="mb-0">Shopping Cart</h5>
            <button class="btn-close btn-close-white" id="closeCart"></button>
        </div>
        <div class="cart-body" id="cartItems">
            <p class="text-center text-muted py-5">Your cart is empty</p>
        </div>
        <div class="cart-footer">
            <div class="d-flex justify-content-between mb-3">
                <span>Total:</span>
                <span id="cartTotal">$0</span>
            </div>
            <button class="btn btn-danger w-100" id="checkoutBtn">Checkout</button>
        </div>
    </div>
    <div class="cart-overlay" id="cartOverlay"></div>

    <!-- Likes Modal -->
    <div class="modal fade" id="likesModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Your Favorites</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="likesItems">
                    <p class="text-center text-muted">No favorites yet</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../javaScript/main.js"></script>
    <script src="../javaScript/enhancements.js"></script>
    <script>
        let currentProduct = null;
        let currentQuantity = 1;
        
        document.addEventListener('DOMContentLoaded', () => {
            loadAllProducts().then(() => {
                loadProductDetails();
            });
        });
        
        async function loadAllProducts() {
            try {
                const path = '../json/products.JSON';
                const response = await fetch(path);
                const data = await response.json();
                allProducts = data.products;
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }
        
        function loadProductDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            if (!productId || !allProducts.length) {
                document.querySelector('.product-detail-section .container').innerHTML = 
                    '<div class="text-center py-5"><h3>Product not found</h3><a href="../../index.html" class="btn btn-primary mt-3">Back to Home</a></div>';
                return;
            }
            
            currentProduct = allProducts.find(p => p.id === parseInt(productId));
            
            if (!currentProduct) {
                document.querySelector('.product-detail-section .container').innerHTML = 
                    '<div class="text-center py-5"><h3>Product not found</h3><a href="../../index.html" class="btn btn-primary mt-3">Back to Home</a></div>';
                return;
            }
            
            // Update page title
            document.title = currentProduct.name + ' - BODYPOMP';
            
            // Populate product details
            document.getElementById('productImage').src = '../../' + currentProduct.image;
            document.getElementById('productName').textContent = currentProduct.name;
            document.getElementById('productCategory').textContent = currentProduct.category;
            document.getElementById('productPrice').textContent = currentProduct.price;
            document.getElementById('productDescription').textContent = getProductDescription(currentProduct);
            
            // Old price
            if (currentProduct.oldPrice) {
                document.getElementById('productOldPrice').textContent = currentProduct.oldPrice;
            } else {
                document.getElementById('productOldPrice').style.display = 'none';
            }
            
            // Discount badge
            if (currentProduct.discount) {
                document.getElementById('productDiscount').textContent = '-' + currentProduct.discount + '%';
            } else {
                document.getElementById('productDiscount').style.display = 'none';
            }
            
            // Rating
            document.getElementById('productRating').innerHTML = generateStars(currentProduct.rating) + 
                '<span class="ms-2">(' + currentProduct.reviews.length + ' reviews)</span>';
            
            // Stock status
            const stockDiv = document.getElementById('productStock');
            if (currentProduct.inStock) {
                stockDiv.innerHTML = '<i class="fas fa-check-circle"></i> In Stock';
                stockDiv.className = 'stock-status-large in-stock mb-4';
                document.getElementById('addToCartBtn').disabled = false;
            } else {
                stockDiv.innerHTML = '<i class="fas fa-times-circle"></i> Out of Stock';
                stockDiv.className = 'stock-status-large out-of-stock mb-4';
                if (currentProduct.restockDate) {
                    stockDiv.innerHTML += '<div class="restock-info">Restock Date: ' + formatRestockDate(currentProduct.restockDate) + '</div>';
                }
                document.getElementById('addToCartBtn').disabled = true;
                document.getElementById('addToCartBtn').innerHTML = '<i class="fas fa-bell me-2"></i> Notify Me';
            }
            
            // Flavors (if applicable)
            if (currentProduct.flavors && currentProduct.flavors.length > 0) {
                document.getElementById('flavorSection').style.display = 'block';
                document.getElementById('flavorOptions').innerHTML = currentProduct.flavors.map(flavor => 
                    '<span class="flavor-option">' + flavor + '</span>'
                ).join('');
            } else {
                document.getElementById('flavorSection').style.display = 'none';
            }
            
            // Reviews
            const reviewsContainer = document.getElementById('reviewsContainer');
            if (currentProduct.reviews.length > 0) {
                reviewsContainer.innerHTML = currentProduct.reviews.map(review => `
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">${review.user.charAt(0).toUpperCase()}</div>
                                <div>
                                    <h6 class="mb-0">${review.user}</h6>
                                    <div class="review-stars">${generateStars(review.rating)}</div>
                                </div>
                            </div>
                        </div>
                        <p class="review-text">${review.comment}</p>
                    </div>
                `).join('');
            } else {
                reviewsContainer.innerHTML = '<p class="text-muted">No reviews yet</p>';
            }
            
            // Update like button state
            updateLikeButtonState();
        }
        
        function getProductDescription(product) {
            const descriptions = {
                'Supplements': 'Premium quality supplement designed to support your fitness goals. Made with high-grade ingredients for maximum effectiveness.',
                'Sportswear': 'High-performance athletic wear designed for comfort and durability. Perfect for intense workouts or casual wear.',
                'Equipment': 'Professional-grade gym equipment built to last. Essential for any home gym or professional facility.',
                'Medicine': 'Health and wellness products to support your active lifestyle. Quality tested for safety and effectiveness.'
            };
            return descriptions[product.category] || 'Quality product for your fitness needs.';
        }
        
        function updateDetailQuantity(change) {
            currentQuantity += change;
            if (currentQuantity < 1) currentQuantity = 1;
            if (currentQuantity > 10) currentQuantity = 10;
            document.getElementById('detailQuantity').value = currentQuantity;
        }
        
        function addCurrentProductToCart() {
            if (!currentProduct || !currentProduct.inStock) return;
            
            for (let i = 0; i < currentQuantity; i++) {
                addToCartById(currentProduct.id);
            }
            
            showToast(currentProduct.name + ' (' + currentQuantity + ') added to cart!');
            currentQuantity = 1;
            document.getElementById('detailQuantity').value = 1;
        }
        
        function toggleCurrentProductLike() {
            if (!currentProduct) return;
            toggleLikeById(currentProduct.id);
            updateLikeButtonState();
        }
        
        function updateLikeButtonState() {
            if (!currentProduct) return;
            const likeBtn = document.getElementById('likeBtn');
            const isLiked = likes.some(l => l.id === currentProduct.id);
            
            if (isLiked) {
                likeBtn.innerHTML = '<i class="fas fa-heart"></i>';
                likeBtn.classList.add('liked');
            } else {
                likeBtn.innerHTML = '<i class="far fa-heart"></i>';
                likeBtn.classList.remove('liked');
            }
        }
    </script>
</body>
</html>
